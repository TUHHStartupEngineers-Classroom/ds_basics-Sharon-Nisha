---
title: "04 Data Visualization"
date: "2021-04"
output:
  html_document:
    toc: true
    toc_float: true
    df_print: paged
    collapsed: false
    number_sections: true
    toc_depth: 3
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message=FALSE,warning=FALSE, cache=TRUE)
```

**IMPORTANT:** You can delete everything in here and start fresh. You might want to start by not deleting anything above this line until you know what that stuff is doing.



# My first post

Last compiled: `r Sys.Date()`
Plotting covid data





```{r}

library(tidyverse)
covid_data_tbl <- read_csv("https://covid.ourworldindata.org/data/owid-covid-data.csv")
new_cov_table<-covid_data_tbl%>%select(continent,date,total_cases)%>%  group_by(continent,date) %>% summarize(total.cases = sum(total_cases)) %>%
    ungroup()


new_cov_table %>% group_by(continent,date)%>% 
    
    ggplot(aes(date,total.cases, fill = continent,color =continent)) +
    
    geom_line(size = 0.5, linetype = 1) +
    # facet_wrap(~ frame_material, ncol = 1) +
  
    theme(legend.position = "bottom")+geom_smooth(method = "loess", span = 0.2)+
  labs(
        title = "Covid cases in the 7 continents",
   
        fill = "continent" ,  
        x = "Date",
        y = "Total cases"

    )

```



library(tidyverse) # loads ggplot2
library(lubridate)

bike_orderlines_tbl <- read_excel("C:/Users/ctaru/Desktop/businessdatascience/ds_data/ds_data/01_bike_sales/01_raw_data/orderlines.xlsx")

# 1.0 Anatomy of a ggplot ----

# 1.1 How ggplot works ----

# Step 1: Format data ----
bike_orderlines_wrangled_tbl %>%
    
    distinct(price, model, frame.material) %>%
    
    ggplot(aes(price, fill = frame.material)) +
    
    geom_density() +
    # facet_wrap(~ frame_material, ncol = 1) +
  
    theme(legend.position = "bottom")

sales_by_year_tbl <- bike_orderlines_wrangled_tbl %>%

  # Selecting columns to focus on and adding a year column
  select(order.date, total.price) %>%
  mutate(year = year(order.date)) %>%

  # Grouping by year, and summarizing sales
  group_by(year) %>%
  summarize(sales = sum(total.price)) %>%
  ungroup() %>%

  # € Format Text
  mutate(sales_text = scales::dollar(sales, 
                                     big.mark     = ".", 
                                     decimal.mark = ",", 
                                     prefix       = "", 
                                     suffix       = " €"))
sales_by_year_tbl %>%

  # Canvas
  ggplot(aes(x = year, y = sales, color = sales)) +

  # Geometries 
  geom_line(size = 1) +
  geom_point(size = 5) +
  geom_smooth(method = "lm", se = FALSE)
revenue_by_month_tbl <- bike_orderlines_wrangled_tbl %>%
    
    select(order.date, total.price) %>%
    
    mutate(year_month = floor_date(order.date, "months") %>% ymd()) %>%
    
    group_by(year_month) %>%
    summarize(revenue = sum(total.price)) %>%
    ungroup()
revenue_by_month_tbl %>%
    
    ggplot(aes(year_month, revenue)) +
    
    geom_line(size = 0.5, linetype = 1)+ 
    geom_smooth(method = "loess", span = 0.2)


revenue_by_category_tbl <- bike_orderlines_wrangled_tbl %>%
    
    select(category, total.price) %>%
    
    group_by(category) %>%
    summarize(revenue = sum(total.price)) %>%
    ungroup()

# Bar Plot

library(tidyverse)
library(readxl)

library(lubridate)
n <- 10
# Data Manipulation
top_customers_tbl <- bike_orderlines_wrangled_tbl %>%
    
    # Select relevant columns
    select(name, total.price)%>%
    
    # Collapse the least frequent values into “other”
    mutate(bikeshop = as_factor(name) %>% fct_lump(n = n, w = total.price)) %>%  # Group and summarize
    group_by(name) %>%
    summarize(revenue = sum(total.price)) %>%
    ungroup() %>%
    
    # Reorder the column customer_city by revenue
    mutate(bikeshop = name %>% fct_reorder(revenue))%>%
    # Place "Other" at the beginning
    mutate(bikeshop = bikeshop %>% fct_relevel("Other", after = 0))%>%
        arrange(desc(bikeshop)) %>%
    
    # Add Revenue Text
    mutate(revenue_text = scales::dollar(revenue, 
                                         scale  = 1e-6, 
                                         prefix = "", 
                                         suffix = "M €"))


revenue_by_category_tbl %>%
    
    mutate(category_2 = category %>% as_factor() %>% fct_reorder(revenue)) %>%
    
    ggplot(aes(category_2, revenue)) +
    
    geom_col(fill = "#2c3e50") + 
    coord_flip()
